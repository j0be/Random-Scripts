javascript: (function() { window.ignoredSubreddits = ['freekarma', 'imgur_all', 'karma', ]; window.parsed = {}; feedPrep = function() { sortFeed(); $('.post').removeClass('red green'); $('.post.powerred').addClass('red'); $('.post.powergreen').addClass('green'); $('.post a, a.post, .thumbs>a').attr('target', '_blank'); clickListener(); }; sortFeed = function() { if (typeof window.sortPosts == 'undefined') { window.sortPosts = confirm('Would you like to sort the posts by ' + ($('.post-info').length > 0 ? 'views instead of age?' : 'score instead of virality?')); } if (window.sortPosts) { $('.thumbs>a>img').each(function() { $(this).attr('original-title', $(this).attr('title')); }); $('.post, .thumbs>a').detach().sort(function(a, b) { var an, bn; if ($(a).find('.point-info-points, .post-info').length > 0) { an = parseFloat($(a).find('.point-info-points, .post-info').first().text().replace(/[^\d]/g, '')); bn = parseFloat($(b).find('.point-info-points, .post-info').first().text().replace(/[^\d]/g, '')); } else { an = parseFloat($(a).find('>img').attr('original-title').replace(/.*?<p>/, '').replace(/:.*/, '').replace(/[^\d]/g, '')); bn = parseFloat($(b).find('>img').attr('original-title').replace(/.*?<p>/, '').replace(/:.*/, '').replace(/[^\d]/g, '')); } if (an < bn) { return 1; }; if (an > bn) { return -1; }; return 0; }).appendTo('.cards,.posts,.thumbs').first(); $('.cards,.posts,.thumbs').slice(1).find('.post,>a').remove(); $('.post.empty').remove(); } }; albumPrep = function() { window.isAlbum = true; window.myimages = imgur._.emitter.callbacks.firstImage[0].this_arg._.albumImageStore._.posts[imgur._.hash].images; $('.post-title').attr('id', imgur._.hash).wrapInner('<a href="//reddit.com/search?sort=new&q=url%3A' + imgur._.hash + ' AND url%3Aimgur&title=" target="_blank"></a>'); $('head').append($('#ps').length == 0 ? '<style id="ps">.post-image.pimg {cursor:pointer} .post-image-container.red {border:2px solid red} .post-image-container.green {border:2px solid green} .post-title.red a {color:red} .post-title.green a {color: green} .post-image img, .post-image video, .post-image object {max-width:100%}</style>' : ''); $('.load-more').click(); clickListener(); $('body').on('DOMNodeInserted', '.post-images', function() { checkAlbum(); }); $('body').on('click', '.remove-image', function() { removeImage($(this)); }); }; clickListener = function() { c_el = '.post a, .post-image a, a.post, .post-image.pimg, .thumbs>a'; $('#content,.post-container').find(c_el).off('click'); $('#content,.post-container').on('click', c_el, function(e) { if ($(this).data('searchhref') && ($(e.target).closest('.post-image-option').length == 0)) { window.open($(this).attr('href')); if ($(this).attr('href') == $(this).data('searchhref')) { $(this).attr('href', $(this).data('ohref')); } else { $(this).attr('href', $(this).data('searchhref')); } e.preventDefault(); return false; } }); }; checkFeed = function() { if ($('.thumbs>a').length > 0 && $('#ps').length == 0) { $('head').append('<style id="ps">.panel a.red img {border-color:red;opacity:.3} .panel a.green img {border-color:green}</style>'); $('.thumbs>a').each(function() { $(this).attr('id', $(this).attr('href').match(/(?!\/)[^\/]*?$/)[0]); }); } if ($('.post,.thumbs>a').filter(':not(.green,.red,.parsing)').length > 0) { checkItem($('.post,.thumbs>a').filter(':not(.green,.red,.parsing)').first(), 'feed'); } else { alert('Done!'); delete window.loc; } }; checkAlbum = function() { if ($('.post-title, .post-image-container').filter(':not(.green,.red,.parsing)').length > 0) { checkItem($('.post-title, .post-image-container').filter(':not(.green,.red,.parsing)').first(), 'album'); } }; checkItem = function(el, origin) { if (!(el.hasClass('red') || el.hasClass('green') || el.hasClass('parsing'))) { if (el.attr('id').length == 5 || el.attr('id').length == 7) { id = el.attr('id'); } else { err('I don\'t know what the id is. :('); } if (window.parsed[id]) { handleEl(window.parsed[id], el); } else { el.addClass('parsing'); $.ajax({ url: 'https://www.reddit.com/search.json?sort=new&q=url%3A' + id + '+AND+url%3Aimgur', context: el }).then(function(data) { $(this).removeClass('parsing'); id = $(this).attr('id'); window.parsed[id] = data; handleEl(data, $(this)); }, function() { $(this).addClass('err'); }); } threshold = 500; if (origin == 'feed') { setTimeout(function() { checkFeed(); }, threshold); } else if (origin == 'album') { setTimeout(function() { checkAlbum(); }, threshold); } } }; handleEl = function(data, el) { el.removeClass('err'); id = el.attr('id'); items = data.data.children; found = false; for (key in items) { item = items[key].data; if (item && item.url && item.subreddit) { found = (item.url.match(id) && $.inArray(item.subreddit, window.ignoredSubreddits) == -1) || found; } } if (window.isAlbum && el.find('.remove-image').length == 0 && imgur._.emitter.callbacks.firstImage[0].this_arg._.auth.hasAccess) { el.find('.post-image-options-all').append('<li class="post-image-option"><a href="javascript:" class="delete remove-image">Remove image from album</a></li>'); } el.addClass(found ? 'red powerred' : 'green powergreen'); targ = el.find('.post-image').length == 0 ? el.find('a') : el.find('.post-image'); targ.last().addClass('pimg ' + (found ? 'repost' : 'safe')).each(function() { $(this).off("click").removeClass('zoom'); id = $(this).closest('.post,.post-image-container,.post-title').attr('id'); title = $(this).next().find('p').text(); $(this).attr({ 'target': '_blank', 'data-ohref': $(this).attr('href') || $(this).find('img[src],source[src]').first().attr('src').replace(/\.(webm|mp4)/g, '.gifv'), 'data-searchhref': '//reddit.com/search?sort=new&q=' + encodeURIComponent('url:' + id + ' AND url:imgur') + '&title=' + encodeURIComponent(title) }); $(this).attr('href', $(this).hasClass('repost') ? $(this).data('searchhref') : $(this).data('ohref')); if ($(this).hasClass('repost')) { $(this).find('img').css('opacity', '.3'); } }); }; redSwap = function() { url = $('#url').val(); if (url.match(/imgur\.com/i)) { ext = url.match(/\..{3,4}$/); if (!$('#url').attr('ext')) { $('#url').attr('ext', ext ? ext[0] : '.png') }; $('#url').val(swapImgur(url)); } if ($('#popup-new').length < 1) { window.urlID = '#url'; $('#suggest-title').append('<a style="float:left" id="popup-new" href="javascript:window.open($(window.urlID).val());">Open Link</a>'); } }; swapImgur = function(url) { var iid = url.match(/[A-Z0-9]{5,7}/gi).last(); ext = url.match(/\..{3,4}$/); returl = url.match(/(\/a\/|\..{3,4}$)/) ? 'https://imgur.com/gallery/' + iid : iid.length == 5 ? 'https://imgur.com/a/' + iid : 'https://i.imgur.com/' + iid + $('#url').attr('ext'); return returl; }; removeImage = function(el) { if (window.isAlbum) { str = ''; id = el.closest('.post-image-container').attr('id'); for (i = 0; i < window.myimages.length; i++) { if (id != window.myimages[i].hash) { str += window.myimages[i].hash + ','; } } str = str.substring(0, str.length - 1); $.ajax({ url: '/ajaxalbums/images/' + imgur._.hash, context: el, method: 'POST', data: { hashes: str, change_cover: false } }).then(function() { id = $(this).closest('.post-image-container').attr('id'); $('head').append('<style>#' + id + '{height:0;overflow:hidden;}</style>'); for (i = 0; i < window.myimages.length; i++) { if (id == window.myimages[i].hash) { window.myimages.splice(i, 1); i = window.myimages.length; } } }, function() { alert('Error removing image'); }); } }; getURLParameter = function(name) { return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search) || [, ""])[1].replace(/\+/g, '%20')) || null; }; action = function() { if (!window.loc) { loc = document.location.href; window.loc = loc; if (loc.match(/reddit\.com.*\/submit/) && $ && $('#url').val().match(/[A-Z0-9]{5,7}/gi)) { redSwap(); } else if (loc.match(/reddit\.com.*\/search.*(imgur||gfycat)/)) { if (id = $('#previoussearch input').first().val().match(/url:.+?( |$)/)) { id = id[0].replace(/url:/g, '').trim(); title = getURLParameter('title') || ''; redir('//www.reddit.com/submit?url=' + encodeURIComponent(id.match(/gfycat/i) ? id : '//imgur.com/' + id) + '&title=' + title + '&resubmit=true'); } else { err(); } } else if (document.location.href.match(/youtu|vine\.co|instagram|vimeo|vid\.me|streamable|\.mp4|\.webm/) && !loc.match('gfycat.com')) { redir('//imgur.com/vidgif/video?url=' + encodeURIComponent(loc)); } else if (loc.match(/(\.jpg|\.gifv?|\.png)/i) && loc.match(/imgur\.com/i)) { redir(swapImgur(loc)); } else if (loc.match('gfycat.com')) { if (!loc.match('//gfycat.com')) { redir(loc.replace(/\/\/.*?\.gfycat/i, '//gfycat').replace(/\.(gif|webm)/i, '')); } else { gfy = superAwesomeGlobalGfyJSON; redir('//reddit.com/search?sort=new&q=' + encodeURIComponent('url:' + gfy.gfyName) + '&title=' + encodeURIComponent(gfy.title)); } } else if (typeof imgur !== 'undefined') { if (id = imgur._.hash) { if (id.length == 7) { redir('//reddit.com/search?sort=new&q=' + encodeURIComponent('url:' + id + ' AND url:imgur') + '&title=' + encodeURIComponent($('.post-title').text())); } else { albumPrep(); setTimeout(function() { checkAlbum(); }, 500); } } else { /*listing*/ feedPrep(); checkFeed(); } } else { err(); } } else { if (typeof imgur !== 'undefined' && !imgur._.hash) { sortFeed(); } } }; err = function(mess) { alert(mess || 'I don\'t know what to do with this.'); }; redir = function(url) { document.location = url; }; if (!Array.prototype.last) { Array.prototype.last = function() { return this[this.length - 1]; }; }; action(); })();