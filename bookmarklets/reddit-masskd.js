javascript: (function() { if (document.location.href.match(/(\/gallery\/|\/a\/)/i)) { /* ALBUM REDDIT SEARCH */ id = document.location.href.replace(/.*\//, '').replace(/\?.*/, ''); $.ajax({ url: "//www.reddit.com/search.json?q=%28url%3A" + (id) + "%29+AND+%28url%3Aimgur%29&u=" + (id) }).success(function(data) { /* Ensuring target accuracy */ sid = this.url.match(/u=.*$/); sid = sid[0].replace('u=', ''); if (data.data.children.length > 0) { repost = false; /* Sometimes reddit returns non relevant results */ for (i = 0; i < data.data.children.length; i++) { if (data.data.children[i].data.url.match(sid)) { repost = true; } } } else { repost = false; } if (repost) { $('#image-title').parent().html('<a href="//www.reddit.com/search?q=%28url%3A' + (sid) + '%29+AND+%28url%3Aimgur%29&sort=new" target="_blank" style="color:#f00; font-size:18px">' + $('#image-title').text() + '</a>'); } else { $('#image-title').parent().html('<a href="//www.reddit.com/search?q=%28url%3A' + (sid) + '%29+AND+%28url%3Aimgur%29&sort=new" target="_blank" style="color:#0f0; font-size:18px">' + $('#image-title').text() + '</a>'); } }).error(function() { alert('Album error'); }); /* KARMA DECAY EACH IMAGE */ $('.album-image, .image').each(function(e) { if ($(this).find('iframe').length == 0) { imgSrc = $(this).find('img, video source, iframe').first().attr('src').replace(/.*?\/\//, '//').replace(/webm/, 'gifv'); id = imgSrc.replace(/.*\//, '').replace(/\?.*/, '').replace(/\..{3,4}$/, ''); $.ajax({ url: "//www.reddit.com/search.json?q=%28url%3A" + (id) + "%29+AND+%28url%3Aimgur%29&u=" + (id) }).success(function(data) { /* Ensuring target accuracy */ sid = this.url.match(/u=.*$/); sid = sid[0].replace('u=', ''); if (data.data.children.length > 0) { repost = false; /* Sometimes reddit returns non relevant results */ for (i = 0; i < data.data.children.length; i++) { if (data.data.children[i].data.url.match(sid)) { repost = true; } } } else { repost = false; } if (repost) { $('#' + sid + '_iframe').parents('.album-image').first().css('background', '#f00'); $('#' + sid + '_iframe').parents('.album-image').first().find('.reddit_search_results').first().html('<a style="color:#333; padding: 3px; font-weight:bold;" href="//www.reddit.com/search?q=%28url%3A' + (sid) + '%29+AND+%28url%3Aimgur%29&sort=new" target="_blank">Recheck</a>'); } else { $('#' + sid + '_iframe').parents('.album-image').first().css('background', '#0f0'); $('#' + sid + '_iframe').parents('.album-image').first().find('.reddit_search_results').first().html('<a style="color:#333; padding: 3px; font-weight:bold;" href="//www.reddit.com/search?q=%28url%3A' + (sid) + '%29+AND+%28url%3Aimgur%29&sort=new" target="_blank">Recheck</a>'); } }).error(function() { alert('Image error:' + id); }); $(this).html('<div class="reddit_search_results"></div><div style="height:450px; width:100%; overflow:hidden; background:#fff;"><iframe id="' + id + '_iframe" style=" margin-top: -150px; width:100%; height:600px; border:0" src="//karmadecay.com/search?kdtoolver=m2&q=' + imgSrc + '"/></div>'); } }); } else { /* THIS IS REDDIT */ if (window.location.protocol == "https:") { if (confirm('This only works on insecure connections, as KD doesn\'t have a SSL. Redirect to reddit without SSL?')) { document.location = document.location.href.replace('https:', 'http:'); } } else { window.i = 0; if ($('#myKD').length == 0) { ms = '<iframe id="myKD" style="width:1px;height:1px;position:absolute;top:0;left:0;" src="#"></iframe>'; ms += '<iframe id="myKW" style="width:1px;height:1px;position:absolute;top:0;left:0;" src="#"></iframe>'; $('body').append(ms); } if ($('.search-result-header').length > 0) { p = 'a.search-link'; } else { p = '.thing a.title'; } ms = '#siteTable '+p+'[href*=".gif"], '; ms += '#siteTable '+p+'[href*=".jpg"], '; ms += '#siteTable '+p+'[href*=".png"], '; ms += '#siteTable '+p+'[href*="imgur.com"], '; ms += '#siteTable '+p+'[href*="gfycat.com"]'; $(ms).parents('.thing:not(.checked), .search-result:not(.checked)').addClass('myKD').css('background', '#cfc'); window.t = setInterval(function() { if (!$('#siteTable .thing.myKD:eq(' + window.i + ')').hasClass('checked')) { url = $('#siteTable .thing.myKD:eq(' + window.i + ') li.first a').attr('href'); /* Anti blocking measures */ url = url.replace(/\/r\/.*?\//, '/r/all/'); url = url.match(/.*?\/r\/all\/(.*?\/){2}/)[0]; $('#myKD').attr('src', '//karmadecay.com/search?kdtoolver=m2&q=' + url); u = $('#siteTable .thing.myKD:eq(' + window.i + ') a.author').first().text(); if (!$('#myKW').attr('src').match(u)) { $('#myKW').attr('src', '//karmawhores.net/user/' + u); } $('#siteTable .thing.myKD:eq(' + window.i + ')').css('background', '#8f8').addClass('checked'); } window.i++; if (window.i >= $('#siteTable .thing.myKD').length) { document.title = "Karma Decay Done!"; $('.myKD').removeClass('myKD'); clearInterval(window.t); } else { document.title = 'KD Checking ' + window.i + ' of ' + $('#siteTable .thing.myKD').length; } }, 2000); } }})();