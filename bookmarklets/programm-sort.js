javascript: (function() { getData = function(offset) { if ($('.promo-' + window.curAge).length > 0) { u = '/api/items/get?older=' + window.curAge + '&flags=1'+(window.topSort ? '&promoted=1' : ''); } else { u = '/api/items/get?flags=1'+(window.topSort ? '&promoted=1' : ''); } $.ajax({ url: u, dataType: 'json', context: document.body }).done(function(resp) { /*Success*/ items = resp.items; for (var key in items) { item = items[key]; id = '#item-' + item['id']; $(id).attr('data-score', parseFloat(item['up']) - parseFloat(item['down'])).addClass('promo-' + (window.topSort ? item['promoted'] : item['id'])); } window.curAge = window.topSort ? items[items.length - 1].promoted : items[items.length - 1].id; sortItems(); removeDupes(); reassemble(); if ($('.promo-' + window.curAge).length > 0) { getData(); }; }).fail(function() { /*Error*/ }).always(function() { /*Complete*/ }); }; sortItems = function() { el = $('.stream-row').first(); $('a.thumb').sort(function(a, b) { if (parseFloat($(a).attr('data-score')) > parseFloat($(b).attr('data-score'))) { return -1; } else if (parseFloat($(a).attr('data-score')) < parseFloat($(b).attr('data-score'))) { return 1; } else { return 0; } }).detach().appendTo(el); $('.stream-row').get().first() }; removeDupes = function() { $('.silent.thumb').each(function() { if (!$(this).attr('data-score')) { $(this).hide(); } else { $(this).show(); } }); }; reassemble = function() { numItems = $('.stream-row').first().width() / 132; $('.stream-row').first().find('.silent.thumb:visible').each(function(i) { if ((i + 1) > numItems) { $(this).detach().appendTo('.stream-row:eq(' + Math.floor(i / numItems) + ')'); } }); }; window.curAge = false; window.topSort = document.location.href.match('top') ? true : false; getData(); })();